from impacket.ldap.ldaptypes import ACCESS_MASK

# https://learn.microsoft.com/en-us/windows/win32/secauthz/well-known-sids
# https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-dtyp/81d92bba-d22b-4a8c-908a-554ab29148ab?source=recommendations
WELL_KNOWN_SIDS = {
    "S-1-0": "Null Authority",
    "S-1-0-0": "Nobody",
    "S-1-1": "World Authority",
    "S-1-1-0": "Everyone",
    "S-1-2": "Local Authority",
    "S-1-2-0": "Local",
    "S-1-2-1": "Console Logon",
    "S-1-3": "Creator Authority",
    "S-1-3-0": "Creator Owner",
    "S-1-3-1": "Creator Group",
    "S-1-3-2": "Creator Owner Server",
    "S-1-3-3": "Creator Group Server",
    "S-1-3-4": "Owner Rights",
    "S-1-4": "Non-unique Authority",
    "S-1-5": "NT Authority",
    "S-1-5-1": "Dialup",
    "S-1-5-2": "Network",
    "S-1-5-3": "Batch",
    "S-1-5-4": "Interactive",
    "S-1-5-6": "Service",
    "S-1-5-7": "Anonymous",
    "S-1-5-8": "Proxy",
    "S-1-5-9": "Enterprise Domain Controllers",
    "S-1-5-10": "Principal Self",
    "S-1-5-11": "Authenticated Users",
    "S-1-5-12": "Restricted Code",
    "S-1-5-13": "Terminal Server Users",
    "S-1-5-14": "Remote Interactive Logon",
    "S-1-5-15": "This Organization",
    "S-1-5-17": "This Organization",
    "S-1-5-18": "Local System",
    "S-1-5-19": "NT Authority",
    "S-1-5-20": "NT Authority",
    "S-1-5-21-0-0-0-496": "Compounded Authentication",  # https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-dtyp/11e1608c-6169-4fbc-9c33-373fc9b224f4#Appendix_A_13
    "S-1-5-21-0-0-0-497": "Claims Valid",  # https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-dtyp/11e1608c-6169-4fbc-9c33-373fc9b224f4#Appendix_A_14
    "S-1-5-32-544": "Administrators",
    "S-1-5-32-545": "Users",
    "S-1-5-32-546": "Guests",
    "S-1-5-32-547": "Power Users",
    "S-1-5-32-548": "Account Operators",
    "S-1-5-32-549": "Server Operators",
    "S-1-5-32-550": "Print Operators",
    "S-1-5-32-551": "Backup Operators",
    "S-1-5-32-552": "Replicators",
    "S-1-5-32-553": "RAS and IAS Servers",
    "S-1-5-32-554": r"BUILTIN\Pre-Windows 2000 Compatible Access",
    "S-1-5-32-555": r"BUILTIN\Remote Desktop Users",
    "S-1-5-32-557": r"BUILTIN\Incoming Forest Trust Builders",
    "S-1-5-32-556": r"BUILTIN\Network Configuration Operators",
    "S-1-5-32-558": r"BUILTIN\Performance Monitor Users",
    "S-1-5-32-559": r"BUILTIN\Performance Log Users",
    "S-1-5-32-560": r"BUILTIN\Windows Authorization Access Group",
    "S-1-5-32-561": r"BUILTIN\Terminal Server License Servers",
    "S-1-5-32-562": r"BUILTIN\Distributed COM Users",
    "S-1-5-32-568": r"BUILTIN\DCOM Users",
    "S-1-5-32-569": r"BUILTIN\Cryptographic Operators",
    "S-1-5-32-571": r"BUILTIN\Cacheable Principals",
    "S-1-5-32-572": r"BUILTIN\Non-Cacheable Principals",
    "S-1-5-32-573": r"BUILTIN\Event Log Readers",
    "S-1-5-32-574": r"BUILTIN\Certificate Service DCOM Access",
    "S-1-5-32-575": r"BUILTIN\RDS Remote Access Servers",
    "S-1-5-32-576": r"BUILTIN\RDS Endpoint Servers",
    "S-1-5-32-577": r"BUILTIN\RDS Management Servers",
    "S-1-5-32-578": r"BUILTIN\Hyper-V Administrators",
    "S-1-5-32-579": r"BUILTIN\Access Control Assistance Operators",
    "S-1-5-32-580": r"BUILTIN\Remote Management Users",
    "S-1-5-32-581": r"BUILTIN\Default Account",
    "S-1-5-32-582": r"BUILTIN\Storage Replica Administrators",
    "S-1-5-32-583": r"BUILTIN\Device Owners",
    "S-1-5-32-584": r"BUILTIN\User Mode Hardware Operators",
    "S-1-5-32-585": r"BUILTIN\OpenSSH Users",
    "S-1-5-33": "Write Restricted Code",
    "S-1-5-64-10": "NTLM Authentication",
    "S-1-5-64-14": "SChannel Authentication",
    "S-1-5-64-21": "Digest Authority",
    "S-1-5-65-1": "This Organization Certificate",  # see https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-pac/39f588d6-21e3-4e09-a9f2-d8f7b9b998bf
    "S-1-5-80": "NT Service",
    "S-1-5-80-0": "All Services",
    "S-1-5-83-0": r"NT VIRTUAL MACHINE\Virtual Machines",
    "S-1-5-84-0-0-0-0-0": "User Mode Drivers",
    "S-1-5-1000": "Other Organization",
    "S-1-16-0": "Untrusted Mandatory Level",
    "S-1-16-4096": "Low Mandatory Level",
    "S-1-16-8192": "Medium Mandatory Level",
    "S-1-16-8448": "Medium Plus Mandatory Level",
    "S-1-16-12288": "High Mandatory Level",
    "S-1-16-16384": "System Mandatory Level",
    "S-1-16-20480": "Protected Process Mandatory Level",
    "S-1-16-28672": "Secure Process Mandatory Level",
    "S-1-18-1": "Authentication Authority Asserted Identity",
    "S-1-18-2": "Service Asserted Identity",
    "S-1-18-3": "Fresh public key identity",
    "S-1-18-5": "MFA Key Property",
    "S-1-18-6": "Attested Key Property",
}

ACCESS_MASK_TO_TEXT_LOOKUP = {
    ACCESS_MASK.GENERIC_READ: "GENERIC_READ",
    ACCESS_MASK.GENERIC_WRITE: "GENERIC_WRITE",
    ACCESS_MASK.GENERIC_EXECUTE: "GENERIC_EXECUTE",
    ACCESS_MASK.GENERIC_ALL: "GENERIC_ALL",
    ACCESS_MASK.MAXIMUM_ALLOWED: "MAXIMUM_ALLOWED",
    ACCESS_MASK.ACCESS_SYSTEM_SECURITY: "ACCESS_SYSTEM_SECURITY",
    ACCESS_MASK.SYNCHRONIZE: "SYNCHRONIZE",
    ACCESS_MASK.WRITE_OWNER: "WRITE_OWNER",
    ACCESS_MASK.WRITE_DACL: "WRITE_DACL",
    ACCESS_MASK.READ_CONTROL: "READ_CONTROL",
    ACCESS_MASK.DELETE: "DELETE",
    # file system rights
    0x00000001: "FILE_READ_DATA",
    0x00000002: "FILE_WRITE_DATA",
    0x00000004: "FILE_APPEND_DATA",
    0x00000008: "FILE_READ_EA",
    0x00000010: "FILE_WRITE_EA",
    0x00000020: "FILE_EXECUTE",
    0x00000040: "FILE_DELETE_CHILD",
    0x00000080: "FILE_READ_ATTRIBUTES",
    0x00000100: "FILE_WRITE_ATTRIBUTES"
}
